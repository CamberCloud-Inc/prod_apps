/*
 * Platform-constrained configuration for CUT&RUN Low-Input TF Mapping
 * Optimized for Camber platform execution
 */

process {
  // General process settings
  errorStrategy = 'retry'
  maxRetries = 2

  // Low resource processes (QC, trimming)
  withLabel:process_low {
    cpus   = { 2 * task.attempt }
    memory = { 4.GB * task.attempt }
    time   = { 2.h * task.attempt }
  }

  // Medium resource processes (alignment, filtering)
  withLabel:process_medium {
    cpus   = { 4 * task.attempt }
    memory = { 16.GB * task.attempt }
    time   = { 4.h * task.attempt }
  }

  // High resource processes (peak calling, consensus)
  withLabel:process_high {
    cpus   = { 8 * task.attempt }
    memory = { 32.GB * task.attempt }
    time   = { 6.h * task.attempt }
  }

  // Very high resource processes (if needed)
  withLabel:process_long {
    cpus   = { 8 * task.attempt }
    memory = { 48.GB * task.attempt }
    time   = { 8.h * task.attempt }
  }

  // CUT&RUN specific process overrides
  withName:'.*:ALIGN_BOWTIE2:BOWTIE2_ALIGN' {
    cpus   = { 6 * task.attempt }
    memory = { 24.GB * task.attempt }
    time   = { 4.h * task.attempt }
  }

  withName:'.*:CUTANDRUN:SEACR_CALLPEAK' {
    cpus   = { 4 * task.attempt }
    memory = { 16.GB * task.attempt }
    time   = { 3.h * task.attempt }
  }

  withName:'.*:CUTANDRUN:MACS2_CALLPEAK' {
    cpus   = { 4 * task.attempt }
    memory = { 16.GB * task.attempt }
    time   = { 3.h * task.attempt }
  }

  withName:'DEEPTOOLS_COMPUTEMATRIX' {
    cpus   = { 6 * task.attempt }
    memory = { 24.GB * task.attempt }
    time   = { 4.h * task.attempt }
  }
}

// Container configuration
singularity {
  enabled = true
  autoMounts = true
  cacheDir = '/camber_work/singularity_cache'
}

docker {
  enabled = false
}

// Execution settings
executor {
  queueSize = 50
  submitRateLimit = '10 sec'
}

// Workflow settings
params {
  max_cpus = 64
  max_memory = 360.GB
  max_time = 24.h
}