{
  "name": "fastquorum-quality-filtering",
  "title": "UMI Consensus & Quality Filtering",
  "description": "Advanced consensus read generation using Unique Molecular Identifiers (UMIs) with quality filtering. Implements fgbio Best Practices for producing high-quality consensus reads from single/multi-UMI and Duplex Sequencing data. Samplesheet format: `sample,fastq_1,fastq_2,fastq_3,fastq_4,read_structure`",
  "version": "1.0.0",
  "engineType": "NEXTFLOW",
  "command": "if [ \"${duplex_seq}\" = \"true\" ]; then nextflow run nf-core/fastquorum --input ${input} --outdir ${outdir} --genome ${genome} --mode ${mode} --duplex_seq --skip_fastqc ${skip_fastqc} -c /etc/mpi/nextflow.camber.config -profile k8s -r 1.0.1; else nextflow run nf-core/fastquorum --input ${input} --outdir ${outdir} --genome ${genome} --mode ${mode} --skip_fastqc ${skip_fastqc} -c /etc/mpi/nextflow.camber.config -profile k8s -r 1.0.1; fi",
  "imageUrl": "https://raw.githubusercontent.com/nf-core/fastquorum/master/docs/images/nf-core-fastquorum_logo_light.png",
  "content": "<h1 class=\"heading-node\">\ud83e\uddec FASTQ Quorum: UMI Consensus & Quality Filtering</h1><p class=\"text-node\"><strong>Generate High-Quality Consensus Reads Using Unique Molecular Identifiers</strong></p><p class=\"text-node\">The nf-core/fastquorum pipeline produces consensus reads using Unique Molecular Identifiers (UMIs) or barcodes, implementing the fgbio Best Practices FASTQ to Consensus Pipeline. It can process single UMI reads, multi-UMI reads, and even Duplex Sequencing data to generate high-confidence consensus sequences with superior accuracy.</p><img src=\"https://raw.githubusercontent.com/nf-core/fastquorum/master/docs/images/nf-core-fastquorum_logo_light.png\" alt=\"nf-core/fastquorum workflow\" width=\"600\" height=\"300\"><h2 class=\"heading-node\">\ud83c\udfaf What This Pipeline Does</h2><p class=\"text-node\">The pipeline transforms raw sequencing reads with UMIs into consensus reads through a comprehensive workflow:</p><ol class=\"list-node\"><li><p class=\"text-node\"><strong>Preprocessing:</strong> Quality control with FastQC, FASTQ to BAM conversion, UMI extraction</p></li><li><p class=\"text-node\"><strong>Alignment:</strong> BWA-based alignment of raw reads to reference genome</p></li><li><p class=\"text-node\"><strong>Grouping:</strong> Group reads by UMI to identify molecules from the same source</p></li><li><p class=\"text-node\"><strong>Consensus Calling:</strong> Generate consensus reads (single-strand or duplex)</p></li><li><p class=\"text-node\"><strong>Quality Filtering:</strong> Filter and mask low-quality consensus bases</p></li><li><p class=\"text-node\"><strong>Final Alignment:</strong> Align filtered consensus reads back to reference</p></li><li><p class=\"text-node\"><strong>Quality Control:</strong> Comprehensive metrics and MultiQC reporting</p></li></ol><h2 class=\"heading-node\">\ud83d\ude80 Pipeline Modes</h2><h3 class=\"heading-node\">Research & Development (R&D) Mode</h3><ul class=\"list-node\"><li><p class=\"text-node\"><strong>Process:</strong> Separate consensus calling and filtering steps</p></li><li><p class=\"text-node\"><strong>Best for:</strong> Detailed analysis, optimization, research projects</p></li><li><p class=\"text-node\"><strong>Outputs:</strong> Intermediate files at each step for analysis</p></li><li><p class=\"text-node\"><strong>Use when:</strong> You need to inspect consensus calling quality before filtering</p></li></ul><h3 class=\"heading-node\">High Throughput (HT) Mode</h3><ul class=\"list-node\"><li><p class=\"text-node\"><strong>Process:</strong> Combined consensus calling and filtering in one step</p></li><li><p class=\"text-node\"><strong>Best for:</strong> Production pipelines, large-scale studies</p></li><li><p class=\"text-node\"><strong>Advantage:</strong> Significantly faster processing time</p></li><li><p class=\"text-node\"><strong>Use when:</strong> You have optimized parameters and need speed</p></li></ul><h2 class=\"heading-node\">\ud83e\uddea Duplex Sequencing Support</h2><p class=\"text-node\"><strong>What is Duplex Sequencing?</strong></p><p class=\"text-node\">Duplex Sequencing uses UMIs to independently tag and sequence both strands of a DNA molecule, enabling:</p><ul class=\"list-node\"><li><p class=\"text-node\"><strong>Ultra-high accuracy:</strong> Error rates as low as 1 in 10 billion bases</p></li><li><p class=\"text-node\"><strong>True mutation detection:</strong> Distinguish real mutations from sequencing errors</p></li><li><p class=\"text-node\"><strong>Low-frequency variants:</strong> Detect rare variants down to 0.01% frequency</p></li><li><p class=\"text-node\"><strong>Applications:</strong> Cancer diagnostics, circulating tumor DNA, rare variant detection</p></li></ul><p class=\"text-node\">Enable with <code class=\"inline\" spellcheck=\"false\">--duplex_seq true</code> parameter for duplex consensus read generation.</p><h2 class=\"heading-node\">\ud83d\udccb Quality Filtering Features</h2><p class=\"text-node\"><strong>Consensus Quality Control Parameters:</strong></p><ul class=\"list-node\"><li><p class=\"text-node\"><strong>Minimum Read Count:</strong> Minimum reads required to call a consensus base</p></li><li><p class=\"text-node\"><strong>Base Quality Threshold:</strong> Minimum input base quality for consensus calling</p></li><li><p class=\"text-node\"><strong>Error Rate Filtering:</strong> Maximum allowable error rate per consensus base</p></li><li><p class=\"text-node\"><strong>Base Masking:</strong> Mask or remove low-quality consensus bases</p></li></ul><h2 class=\"heading-node\">\ud83d\udcca Input Requirements</h2><p class=\"text-node\"><strong>Sample Sheet Format (CSV):</strong></p><pre class=\"block-node\"><code>sample,fastq_1,fastq_2,fastq_3,fastq_4,read_structure\nsample1,R1.fastq.gz,R2.fastq.gz,,,8M+T,8M+T\nsample2,R1.fastq.gz,R2.fastq.gz,R3.fastq.gz,,8M+T,8M+T,+T</code></pre><ul class=\"list-node\"><li><p class=\"text-node\"><strong>Supports 1-4 FASTQ files per sample:</strong> Flexible for different UMI configurations</p></li><li><p class=\"text-node\"><strong>Read Structure:</strong> Explicitly specify UMI and template locations</p></li><li><p class=\"text-node\"><strong>Paired-end & Single-end:</strong> Both sequencing modes supported</p></li></ul><p class=\"text-node\"><strong>Read Structure Examples:</strong></p><ul class=\"list-node\"><li><p class=\"text-node\"><code class=\"inline\" spellcheck=\"false\">8M+T</code> - 8bp UMI followed by template sequence</p></li><li><p class=\"text-node\"><code class=\"inline\" spellcheck=\"false\">+T</code> - All template (no UMI)</p></li><li><p class=\"text-node\"><code class=\"inline\" spellcheck=\"false\">3M2S+T</code> - 3bp UMI, 2bp spacer, then template</p></li></ul><h2 class=\"heading-node\">\ud83e\uddec Reference Genome Selection</h2><p class=\"text-node\">Choose from comprehensive reference genomes:</p><ul class=\"list-node\"><li><p class=\"text-node\"><strong>Human:</strong> GRCh37, GRCh38, CHM13, hg19, hg38</p></li><li><p class=\"text-node\"><strong>Model Organisms:</strong> Mouse (GRCm38, GRCm39, mm10), zebrafish, fly, C. elegans</p></li><li><p class=\"text-node\"><strong>Clinical:</strong> Optimized for cancer genomics, liquid biopsy, rare variant detection</p></li></ul><p class=\"text-node\"><strong>Or provide custom reference:</strong></p><ul class=\"list-node\"><li><p class=\"text-node\">FASTA file with <code class=\"inline\" spellcheck=\"false\">--fasta</code> parameter</p></li><li><p class=\"text-node\">Indices generated automatically</p></li><li><p class=\"text-node\">Save indices with <code class=\"inline\" spellcheck=\"false\">--save_reference</code></p></li></ul><h2 class=\"heading-node\">\ud83d\udcca Comprehensive Outputs</h2><h3 class=\"heading-node\">Consensus Read Data</h3><ul class=\"list-node\"><li><p class=\"text-node\"><strong>Consensus BAM files:</strong> High-quality consensus alignments</p></li><li><p class=\"text-node\"><strong>Raw read BAM files:</strong> Original aligned reads with UMI tags</p></li><li><p class=\"text-node\"><strong>Grouping metrics:</strong> UMI family size distributions</p></li><li><p class=\"text-node\"><strong>Quality statistics:</strong> Per-base consensus quality scores</p></li></ul><h3 class=\"heading-node\">Quality Control Reports</h3><ul class=\"list-node\"><li><p class=\"text-node\"><strong>FastQC Reports:</strong> Raw read quality assessment</p></li><li><p class=\"text-node\"><strong>Duplex Metrics:</strong> Duplex sequencing statistics (when enabled)</p></li><li><p class=\"text-node\"><strong>MultiQC Report:</strong> Comprehensive interactive summary</p></li><li><p class=\"text-node\"><strong>Filtering Statistics:</strong> Consensus filtering and masking metrics</p></li></ul><h3 class=\"heading-node\">Analysis-Ready Files</h3><ul class=\"list-node\"><li><p class=\"text-node\"><strong>Sorted & Indexed BAMs:</strong> Ready for variant calling</p></li><li><p class=\"text-node\"><strong>Consensus FASTQ:</strong> For downstream analysis</p></li><li><p class=\"text-node\"><strong>Metrics Tables:</strong> CSV/TSV format for plotting</p></li></ul><h2 class=\"heading-node\">\ud83d\udd2c Use Cases</h2><ul class=\"list-node\"><li><p class=\"text-node\"><strong>Cancer Genomics:</strong> Detect low-frequency somatic mutations</p></li><li><p class=\"text-node\"><strong>Liquid Biopsy:</strong> Circulating tumor DNA (ctDNA) analysis</p></li><li><p class=\"text-node\"><strong>Error Correction:</strong> Reduce sequencing errors for accurate variant calling</p></li><li><p class=\"text-node\"><strong>Rare Variant Detection:</strong> Find variants below typical sequencing error rates</p></li><li><p class=\"text-node\"><strong>Quality Enhancement:</strong> Improve base quality scores for downstream analysis</p></li><li><p class=\"text-node\"><strong>Ancient DNA:</strong> High-confidence consensus from degraded samples</p></li></ul><h2 class=\"heading-node\">\u26a1 Performance Optimization</h2><ul class=\"list-node\"><li><p class=\"text-node\"><strong>High Throughput Mode:</strong> 2-3x faster for production pipelines</p></li><li><p class=\"text-node\"><strong>Skip FastQC:</strong> Save time when raw read quality is known</p></li><li><p class=\"text-node\"><strong>Resource Scaling:</strong> Automatically scales with data size</p></li><li><p class=\"text-node\"><strong>Parallel Processing:</strong> Process multiple samples simultaneously</p></li></ul><p class=\"text-node\"><strong>Perfect for Research in:</strong> Cancer genomics \u2022 Liquid biopsy \u2022 Rare variant detection \u2022 Ancient DNA \u2022 Error-corrected sequencing \u2022 Precision medicine \u2022 Clinical diagnostics \u2022 Population genetics</p><p class=\"text-node\">Built with <a class=\"link\" href=\"https://www.nextflow.io/\" target=\"_blank\">Nextflow</a> \u2022 Powered by <a class=\"link\" href=\"https://nf-co.re/fastquorum\" target=\"_blank\">nf-core/fastquorum v1.0.1</a> \u2022 Implements <a class=\"link\" href=\"http://fulcrumgenomics.github.io/fgbio/\" target=\"_blank\">fgbio</a> Best Practices \u2022 Containerized execution \u2022 Continuous integration tested</p>",
  "spec": [
    {
      "type": "Stash File",
      "label": "Sample Sheet",
      "name": "input",
      "description": "CSV samplesheet with columns: sample, fastq_1, fastq_2, fastq_3, fastq_4, read_structure.",
      "defaultValue": "",
      "hidden": false,
      "required": true,
      "disabled": false,
      "restrictions": {
        "allow_files": true,
        "allow_folders": false,
        "allowed_file_types": [
          ".csv"
        ]
      }
    },
    {
      "type": "Stash File",
      "label": "Output Directory",
      "name": "outdir",
      "description": "Directory for analysis results and reports.",
      "defaultValue": "./fastquorum-results",
      "hidden": false,
      "required": true,
      "disabled": false,
      "restrictions": {
        "allow_files": false,
        "allow_folders": true,
        "allowed_file_types": []
      }
    },
    {
      "type": "Select",
      "label": "Reference Genome",
      "name": "genome",
      "description": "Reference genome for alignment and consensus generation.",
      "defaultValue": "GRCh38",
      "hidden": false,
      "required": true,
      "disabled": false,
      "options": [
        {
          "label": "Human GRCh38 (NCBI)",
          "value": "GRCh38"
        },
        {
          "label": "Human GRCh37 (Ensembl)",
          "value": "GRCh37"
        },
        {
          "label": "Human CHM13 (UCSC)",
          "value": "CHM13"
        },
        {
          "label": "Human hg38 (UCSC)",
          "value": "hg38"
        },
        {
          "label": "Human hg19 (UCSC)",
          "value": "hg19"
        },
        {
          "label": "Mouse GRCm39 (Ensembl)",
          "value": "GRCm39"
        },
        {
          "label": "Mouse GRCm38 (Ensembl)",
          "value": "GRCm38"
        },
        {
          "label": "Mouse mm10 (UCSC)",
          "value": "mm10"
        },
        {
          "label": "Mouse mm39 (UCSC)",
          "value": "mm39"
        },
        {
          "label": "Zebrafish GRCz11 (Ensembl)",
          "value": "GRCz11"
        },
        {
          "label": "Zebrafish GRCz10 (Ensembl)",
          "value": "GRCz10"
        },
        {
          "label": "Fly BDGP6 (Ensembl)",
          "value": "BDGP6"
        },
        {
          "label": "C. elegans WBcel235 (Ensembl)",
          "value": "WBcel235"
        }
      ]
    },
    {
      "type": "Select",
      "label": "Pipeline Mode",
      "name": "mode",
      "description": "Processing mode: R&D (detailed analysis) or HT (high throughput, faster).",
      "defaultValue": "ht",
      "hidden": false,
      "required": true,
      "disabled": false,
      "options": [
        {
          "label": "High Throughput (HT) - Fast, combined processing",
          "value": "ht"
        },
        {
          "label": "Research & Development (R&D) - Detailed, separate steps",
          "value": "rd"
        }
      ]
    },
    {
      "type": "Select",
      "label": "Duplex Sequencing",
      "name": "duplex_seq",
      "description": "Enable duplex sequencing mode for ultra-high accuracy consensus reads.",
      "defaultValue": "false",
      "hidden": false,
      "required": false,
      "disabled": false,
      "options": [
        {
          "label": "Disabled (Standard UMI consensus)",
          "value": "false"
        },
        {
          "label": "Enabled (Duplex consensus reads)",
          "value": "true"
        }
      ]
    },
    {
      "type": "Select",
      "label": "Skip FastQC",
      "name": "skip_fastqc",
      "description": "Skip FastQC quality control step (useful when raw read quality is known).",
      "defaultValue": "false",
      "hidden": false,
      "required": false,
      "disabled": false,
      "options": [
        {
          "label": "Run FastQC (recommended)",
          "value": "false"
        },
        {
          "label": "Skip FastQC (faster)",
          "value": "true"
        }
      ]
    }
  ],
  "jobConfig": [
    {
      "type": "Select",
      "label": "System Size",
      "name": "system_size",
      "hidden": true,
      "description": "Resource allocation for the pipeline.",
      "options": [
        {
          "label": "Medium (32 CPUs, 180GB RAM) - Small studies",
          "value": "medium",
          "mapValue": {
            "nodeSize": "MEDIUM",
            "numNodes": 1,
            "withGpu": false
          }
        },
        {
          "label": "Large (64 CPUs, 360GB RAM) - Recommended",
          "value": "large",
          "mapValue": {
            "nodeSize": "LARGE",
            "numNodes": 1,
            "withGpu": false
          }
        },
        {
          "label": "XLarge (96 CPUs, 540GB RAM) - Large cohorts",
          "value": "xlarge",
          "mapValue": {
            "nodeSize": "XLARGE",
            "numNodes": 1,
            "withGpu": false
          }
        }
      ],
      "defaultValue": "large"
    }
  ],
  "tags": [
    {
      "name": "genomics",
      "type": "subfield"
    },
    {
      "name": "quality-control",
      "type": "task"
    },
    {
      "name": "umi",
      "type": "method"
    },
    {
      "name": "consensus",
      "type": "method"
    }
  ]
}