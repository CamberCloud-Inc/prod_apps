/*
 * Camber Platform Configuration for CUT&RUN Histone Modifications
 * Optimized for epigenetic profiling of histone marks with lower background
 */

// Process resource allocation optimized for histone mark analysis
process {
    // Default resources for most processes
    withLabel:process_low {
        cpus   = { 2 * task.attempt }
        memory = { 12.GB * task.attempt }
        time   = { 4.h * task.attempt }
    }

    withLabel:process_medium {
        cpus   = { 6 * task.attempt }
        memory = { 36.GB * task.attempt }
        time   = { 8.h * task.attempt }
    }

    withLabel:process_high {
        cpus   = { 12 * task.attempt }
        memory = { 72.GB * task.attempt }
        time   = { 16.h * task.attempt }
    }

    // Alignment process - critical for CUT&RUN sensitivity
    withName:'.*:ALIGN_BOWTIE2:BOWTIE2_ALIGN' {
        cpus   = { 8 * task.attempt }
        memory = { 32.GB * task.attempt }
        time   = { 8.h * task.attempt }
    }

    // Peak calling - optimized for broad histone marks
    withName:'.*:MACS2_CALLPEAK' {
        cpus   = { 4 * task.attempt }
        memory = { 24.GB * task.attempt }
        time   = { 6.h * task.attempt }
    }

    withName:'.*:SEACR_CALLPEAK' {
        cpus   = { 2 * task.attempt }
        memory = { 16.GB * task.attempt }
        time   = { 4.h * task.attempt }
    }
}

// Container settings for Camber platform
singularity {
    enabled = true
    autoMounts = true
}

docker {
    enabled = false
}

// Retry strategy for robust processing
maxRetries = 2
errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }