// ChIP-seq with Input Control Configuration
// Optimized for standard ChIP-seq experimental design with matched input DNA controls
// Configured for LARGE node (64 CPUs, 360GB RAM)

process {
    // Default resource allocation for standard processes
    cpus = 4
    memory = '16.GB'
    time = '24.h'

    // Quality control processes
    withName:FASTQC {
        cpus = 8
        memory = '16.GB'
        time = '4.h'
    }

    withName:MULTIQC {
        cpus = 4
        memory = '16.GB'
        time = '4.h'
    }

    // Read trimming
    withName:'.*:TRIMGALORE.*' {
        cpus = 4
        memory = '16.GB'
        time = '8.h'
    }

    // Alignment processes - BWA or BOWTIE2
    withName:'.*:BWA_MEM.*' {
        cpus = 16
        memory = '48.GB'
        time = '12.h'
    }

    withName:'.*:BOWTIE2_ALIGN.*' {
        cpus = 16
        memory = '48.GB'
        time = '12.h'
    }

    // BAM processing
    withName:'.*:SAMTOOLS.*' {
        cpus = 8
        memory = '24.GB'
        time = '8.h'
    }

    withName:'.*:PICARD.*' {
        cpus = 8
        memory = '32.GB'
        time = '8.h'
    }

    // Peak calling - MACS2 (critical step for ChIP-seq)
    withName:'.*:MACS2_CALLPEAK.*' {
        cpus = 4
        memory = '32.GB'
        time = '12.h'
    }

    // Downstream analysis
    withName:'.*:HOMER.*' {
        cpus = 8
        memory = '24.GB'
        time = '8.h'
    }

    withName:'.*:DEEPTOOLS.*' {
        cpus = 12
        memory = '36.GB'
        time = '12.h'
    }

    // Consensus peak analysis
    withName:'.*:CONSENSUS_PEAKS.*' {
        cpus = 4
        memory = '16.GB'
        time = '8.h'
    }

    // Differential binding analysis
    withName:'.*:DESEQ2.*' {
        cpus = 4
        memory = '32.GB'
        time = '8.h'
    }

    // Process labels optimized for ChIP-seq workflow
    withLabel:process_single { cpus = 2; memory = '8.GB'; time = '4.h' }
    withLabel:process_low { cpus = 4; memory = '16.GB'; time = '8.h' }
    withLabel:process_medium { cpus = 12; memory = '36.GB'; time = '12.h' }
    withLabel:process_high { cpus = 16; memory = '48.GB'; time = '24.h' }
    withLabel:process_long { cpus = 8; memory = '24.GB'; time = '48.h' }
    withLabel:process_high_memory { cpus = 8; memory = '64.GB'; time = '24.h' }

    // Error handling with retry strategy
    errorStrategy = 'retry'
    maxRetries = 2
}

// Container configuration - CRITICAL for Camber platform
singularity {
    enabled = true
    autoMounts = true
}

docker {
    enabled = false  // Must be false on Camber platform
}

// NO max_cpus, max_memory, max_time parameters - platform doesn't support them
// NO container overrides - let platform handle container management
// NO executor overrides - let platform handle job scheduling