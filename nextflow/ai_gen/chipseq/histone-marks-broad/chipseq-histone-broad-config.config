// CHIPSEQ HISTONE MARKS BROAD PEAK CONFIGURATION
// Optimized for histone modification ChIP-seq analysis with broad peak calling
// Designed for LARGE node (64 CPUs, 360GB RAM)

process {
    // Default resource allocation
    cpus = 4
    memory = '16.GB'
    time = '24.h'

    // Quality control processes
    withName:FASTQC {
        cpus = 8
        memory = '32.GB'
        time = '12.h'
    }

    withName:MULTIQC {
        cpus = 4
        memory = '16.GB'
        time = '8.h'
    }

    withName:'.*:TRIMGALORE.*' {
        cpus = 8
        memory = '24.GB'
        time = '24.h'
    }

    // Alignment processes - resource intensive for ChIP-seq
    withName:'.*:BWA_MEM.*' {
        cpus = 16
        memory = '64.GB'
        time = '24.h'
    }

    withName:'.*:BOWTIE2_ALIGN.*' {
        cpus = 16
        memory = '64.GB'
        time = '24.h'
    }

    withName:'.*:STAR_ALIGN.*' {
        cpus = 24
        memory = '96.GB'
        time = '36.h'
    }

    withName:'.*:CHROMAP_CHROMAP.*' {
        cpus = 16
        memory = '64.GB'
        time = '24.h'
    }

    // Peak calling - MACS2/MACS3 for histone marks
    withName:'.*:MACS2_CALLPEAK.*' {
        cpus = 4
        memory = '32.GB'
        time = '24.h'
    }

    withName:'.*:MACS3_CALLPEAK.*' {
        cpus = 4
        memory = '32.GB'
        time = '24.h'
    }

    // Post-alignment processing
    withName:'.*:PICARD_MERGESAMFILES.*' {
        cpus = 8
        memory = '48.GB'
        time = '24.h'
    }

    withName:'.*:PICARD_MARKDUPLICATES.*' {
        cpus = 8
        memory = '48.GB'
        time = '24.h'
    }

    withName:'.*:SAMTOOLS.*' {
        cpus = 8
        memory = '32.GB'
        time = '24.h'
    }

    // BigWig generation for visualization
    withName:'.*:DEEPTOOLS.*' {
        cpus = 12
        memory = '48.GB'
        time = '24.h'
    }

    withName:'.*:UCSC_BEDGRAPHTOBIGWIG.*' {
        cpus = 4
        memory = '24.GB'
        time = '12.h'
    }

    // Consensus peak calling
    withName:'.*:HOMER_ANNOTATEPEAKS.*' {
        cpus = 4
        memory = '24.GB'
        time = '12.h'
    }

    withName:'.*:SUBREAD_FEATURECOUNTS.*' {
        cpus = 8
        memory = '32.GB'
        time = '12.h'
    }

    // Process labels optimized for large node
    withLabel:process_single { cpus = 2; memory = '8.GB'; time = '12.h' }
    withLabel:process_low { cpus = 4; memory = '16.GB'; time = '24.h' }
    withLabel:process_medium { cpus = 12; memory = '48.GB'; time = '36.h' }
    withLabel:process_high { cpus = 24; memory = '96.GB'; time = '48.h' }
    withLabel:process_long { cpus = 8; memory = '32.GB'; time = '72.h' }
    withLabel:process_high_memory { cpus = 16; memory = '128.GB'; time = '48.h' }

    // Error handling
    errorStrategy = 'retry'
    maxRetries = 2
}

// Container configuration - CRITICAL for Camber platform
singularity {
    enabled = true
    autoMounts = true
}

docker {
    enabled = false  // Docker not available on Camber
}

// NO max_cpus, max_memory, max_time parameters - platform doesn't support them
// NO container overrides - let platform handle
// NO executor overrides - let platform handle