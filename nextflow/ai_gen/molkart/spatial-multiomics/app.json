{
  "name": "molkart-spatial-multiomics",
  "title": "Molecular Cartography Spatial Transcriptomics",
  "description": "Comprehensive spatial transcriptomics analysis for Molecular Cartography combinatorial FISH data. Processes spot positions, performs cell segmentation, assigns transcripts to cells, and generates quality metrics for spatial gene expression mapping. Samplesheet format: `x,y,z`",
  "version": "1.0.0",
  "imageUrl": "https://raw.githubusercontent.com/nf-core/molkart/master/docs/images/molkart_metro_map.png",
  "command": "rm -rf prod_apps && git clone git@github.com:CamberCloud-Inc/prod_apps.git && cd ./prod_apps/nextflow/molkart/spatial-multiomics/ && sh run_molkart.sh",
  "engineType": "NEXTFLOW",
  "content": "<h2><strong>Molkart - Molecular Cartography Spatial Transcriptomics</strong></h2><p>Analyzes combinatorial Fluorescence In Situ Hybridization (FISH) data from Resolve Bioscience's Molecular Cartography platform. Performs end-to-end processing from spot detection through cell segmentation to generate spatially-resolved single-cell transcriptomics data.</p><h3><strong>What is Molecular Cartography?</strong></h3><blockquote><p><strong>Molecular Cartography</strong> uses combinatorial barcoding to detect hundreds to thousands of genes simultaneously in tissue sections at single-molecule resolution. The technology provides spatial coordinates for individual mRNA transcripts, enabling reconstruction of gene expression within native tissue architecture.</p></blockquote><h3><strong>Key Features</strong></h3><ul><li><strong>Image Preprocessing</strong>: Grid pattern filling and contrast enhancement for optimal segmentation</li><li><strong>Multiple Segmentation Methods</strong>: Cellpose, Mesmer, ilastik, or Stardist</li><li><strong>Spot Deduplication</strong>: Identifies and removes duplicate spots near grid boundaries</li><li><strong>Transcript Assignment</strong>: Maps detected transcripts to segmented cells</li><li><strong>Quality Metrics</strong>: Comprehensive QC including spot assignment rates and cell statistics</li></ul><h3><strong>Pipeline Workflow</strong></h3><ol><li><strong>Image Preprocessing</strong>: Fill grid gaps and enhance contrast in nuclear/membrane images</li><li><strong>Cell Segmentation</strong>: Apply chosen segmentation algorithm to identify cell boundaries</li><li><strong>Spot Processing</strong>: Load transcript coordinates and detect duplicates</li><li><strong>Transcript-to-Cell Assignment</strong>: Map each transcript to its corresponding cell</li><li><strong>Quality Control</strong>: Generate comprehensive metrics and MultiQC report</li></ol><h3><strong>Scientific Applications</strong></h3><ul><li><strong>Tissue Architecture Mapping</strong>: Visualize gene expression in spatial context</li><li><strong>Cell-Cell Interactions</strong>: Study communication between neighboring cells</li><li><strong>Tumor Microenvironment</strong>: Characterize immune infiltration and cancer cell states</li><li><strong>Developmental Biology</strong>: Track spatial gene expression patterns during development</li><li><strong>Neuroscience</strong>: Map neuronal populations and circuit organization</li></ul><h3><strong>Input Requirements</strong></h3><ul><li><strong>Sample Sheet</strong>: CSV with sample ID, nuclear image, spot locations, optional membrane image</li><li><strong>Nuclear Image</strong>: DAPI or equivalent nuclear staining (TIFF format)</li><li><strong>Spot Locations Table</strong>: Transcript positions with x, y, z coordinates and gene identities</li><li><strong>Membrane Image</strong>: Optional cytoplasmic/membrane staining for improved segmentation</li></ul><h3><strong>Main Outputs</strong></h3><ul><li><strong>Cell-by-Transcript Matrix</strong>: Single-cell expression data with spatial coordinates</li><li><strong>Segmentation Masks</strong>: Cell boundary images for visualization</li><li><strong>Preprocessed Images</strong>: Gap-filled and contrast-enhanced images</li><li><strong>QC Reports</strong>: Spot assignment rates, cells detected, transcripts per cell</li><li><strong>MultiQC Report</strong>: Comprehensive quality metrics across all samples</li></ul><blockquote><p><strong>Perfect for:</strong> Spatial Transcriptomics \u2022 Tissue Mapping \u2022 Single-Cell Resolution \u2022 Molecular Cartography \u2022 MERSCOPE Data \u2022 Combinatorial FISH</p></blockquote>",
  "jobConfig": [
    {
      "type": "Select",
      "label": "System Size",
      "name": "system_size",
      "options": [
        {
          "label": "default",
          "value": "default",
          "mapValue": {
            "nodeSize": "MEDIUM",
            "numNodes": 4,
            "withGpu": false
          }
        },
        {
          "label": "SMALL",
          "value": "small",
          "mapValue": {
            "nodeSize": "SMALL",
            "numNodes": 2,
            "withGpu": false
          }
        },
        {
          "label": "MEDIUM",
          "value": "medium",
          "mapValue": {
            "nodeSize": "MEDIUM",
            "numNodes": 4,
            "withGpu": false
          }
        },
        {
          "label": "LARGE",
          "value": "large",
          "mapValue": {
            "nodeSize": "LARGE",
            "numNodes": 8,
            "withGpu": false
          }
        }
      ],
      "defaultValue": "default"
    }
  ],
  "spec": [
    {
      "label": "input",
      "name": "input",
      "description": "Path to CSV samplesheet containing sample ID, nuclear image (TIFF), spot locations table, and optional membrane image. Required format: sample,nuclear_image,spot_locations,membrane_image",
      "defaultValue": [],
      "hidden": false,
      "required": true,
      "disabled": false,
      "type": "Multi Stash File"
    },
    {
      "label": "outdir",
      "name": "outdir",
      "description": "The output directory where results will be saved including cell-by-transcript tables, segmentation masks, preprocessed images, and quality control reports.",
      "defaultValue": [],
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Multi Stash File"
    },
    {
      "label": "email",
      "name": "email",
      "description": "Email address for completion summary and notifications.",
      "defaultValue": "",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "segmentation_method",
      "name": "segmentation_method",
      "description": "Select the segmentation tool to apply for cell segmentation. Mesmer is optimized for nuclear and membrane stains, Cellpose offers versatile deep learning segmentation, ilastik provides pixel classification, and Stardist excels at star-convex nuclei detection.",
      "defaultValue": "mesmer",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Radio",
      "options": [
        {
          "label": "Mesmer (nuclear + membrane)",
          "value": "mesmer"
        },
        {
          "label": "Cellpose",
          "value": "cellpose"
        },
        {
          "label": "ilastik",
          "value": "ilastik"
        },
        {
          "label": "Stardist",
          "value": "stardist"
        }
      ]
    },
    {
      "label": "segmentation_min_area",
      "name": "segmentation_min_area",
      "description": "Minimum area size (in pixels) for segmentation masks. Masks smaller than this will be filtered out to remove artifacts and debris.",
      "defaultValue": "100",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "segmentation_max_area",
      "name": "segmentation_max_area",
      "description": "Maximum area size (in pixels) for segmentation masks. Masks larger than this will be filtered out to remove artifacts and clumps.",
      "defaultValue": "10000",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "skip_mindagap",
      "name": "skip_mindagap",
      "description": "Skip the Mindagap grid pattern filling step if your images do not contain tile gaps or if preprocessing is not needed.",
      "defaultValue": false,
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Checkbox"
    },
    {
      "label": "mindagap_boxsize",
      "name": "mindagap_boxsize",
      "description": "Box size parameter for Mindagap gap filling algorithm. Larger values fill larger gaps but may introduce artifacts.",
      "defaultValue": "3",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "clahe_cliplimit",
      "name": "clahe_cliplimit",
      "description": "Contrast limit for CLAHE (Contrast Limited Adaptive Histogram Equalization). Higher values increase contrast enhancement. Range: 0.0 to 1.0",
      "defaultValue": "0.01",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "clahe_kernel",
      "name": "clahe_kernel",
      "description": "Kernel size for CLAHE processing. Larger kernels consider more pixels for local contrast adjustment.",
      "defaultValue": "8",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "create_training_subset",
      "name": "create_training_subset",
      "description": "Create a subset of images for training custom segmentation models. Useful for developing domain-specific segmentation approaches.",
      "defaultValue": false,
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Checkbox"
    },
    {
      "label": "crop_size_x",
      "name": "crop_size_x",
      "description": "Width (in pixels) of image crops to extract for training subset generation.",
      "defaultValue": "400",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "crop_size_y",
      "name": "crop_size_y",
      "description": "Height (in pixels) of image crops to extract for training subset generation.",
      "defaultValue": "400",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "crop_amount",
      "name": "crop_amount",
      "description": "Number of random crops to extract from each image for training subset creation.",
      "defaultValue": "4",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "cellpose_diameter",
      "name": "cellpose_diameter",
      "description": "Expected cell diameter in pixels for Cellpose segmentation. Set to 0 for automatic estimation.",
      "defaultValue": "0",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "cellpose_model",
      "name": "cellpose_model",
      "description": "Pre-trained Cellpose model to use. 'nuclei' for nuclear stains, 'cyto' for cytoplasmic stains, 'cyto2' for improved cell detection.",
      "defaultValue": "nuclei",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Radio",
      "options": [
        {
          "label": "nuclei",
          "value": "nuclei"
        },
        {
          "label": "cyto",
          "value": "cyto"
        },
        {
          "label": "cyto2",
          "value": "cyto2"
        }
      ]
    },
    {
      "label": "cellpose_flow_threshold",
      "name": "cellpose_flow_threshold",
      "description": "Flow threshold for Cellpose. Lower values are more permissive and may oversegment. Range: 0.0 to 3.0",
      "defaultValue": "0.4",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "cellpose_cellprob_threshold",
      "name": "cellpose_cellprob_threshold",
      "description": "Cell probability threshold for Cellpose. Lower values detect more cells. Range: -6.0 to 6.0",
      "defaultValue": "0.0",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "mesmer_image_mpp",
      "name": "mesmer_image_mpp",
      "description": "Microns per pixel resolution for Mesmer segmentation. Affects the scale at which segmentation is performed.",
      "defaultValue": "0.5",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "spot_distance_threshold",
      "name": "spot_distance_threshold",
      "description": "Maximum distance (in pixels) for assigning spots to segmented cells. Spots beyond this distance are considered unassigned.",
      "defaultValue": "5",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "multiqc_title",
      "name": "multiqc_title",
      "description": "Custom title for the MultiQC report. Printed as page header and used for filename if not otherwise specified.",
      "defaultValue": "",
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Input"
    },
    {
      "label": "multiqc_methods_description",
      "name": "multiqc_methods_description",
      "description": "Custom MultiQC yaml file containing HTML including a methods description for the analysis report.",
      "defaultValue": [],
      "hidden": false,
      "required": false,
      "disabled": false,
      "type": "Multi Stash File"
    }
  ],
  "tags": [
    {
      "id": "fb1ee42a-629a-4d99-9e7f-1da3c5f7a691",
      "name": "biology",
      "type": "field"
    },
    {
      "id": "6e4e74a4-560e-4674-95c3-60fe895b8c91",
      "name": "genomics",
      "type": "subfield"
    },
    {
      "id": "831477f4-f572-4e27-af83-037661489800",
      "name": "analysis",
      "type": "task"
    }
  ]
}