{
  "name": "tbprofiler-tb-genomics",
  "title": "Drug Resistance & Lineage Analysis",
  "description": "Comprehensive Mycobacterium tuberculosis genomic analysis pipeline for detecting drug resistance mutations, predicting antimicrobial resistance profiles, and determining strain lineages from whole genome sequencing data. Essential for clinical diagnostics, outbreak investigation, and tuberculosis surveillance programs. Samplesheet format: `sample,fastq_1,fastq_2`",
  "content": "<h1>TB Genomics: Drug Resistance & Lineage Analysis with TBProfiler</h1><h2>What This Analysis Does</h2><p>This pipeline analyzes whole genome sequencing (WGS) data from <em>Mycobacterium tuberculosis</em> samples to identify drug resistance-associated mutations and classify strain lineages. Using TBProfiler (v6.6.5), it automatically processes raw sequencing reads through quality control, alignment, variant calling, and annotation to generate comprehensive reports on antimicrobial resistance (AMR) profiles and phylogenetic lineages. This enables rapid, culture-free diagnosis of drug-resistant tuberculosis and epidemiological tracking of TB transmission chains.</p><h2>When To Use This</h2><ul><li><strong>Clinical Diagnostics:</strong> Rapid detection of multi-drug resistant (MDR-TB) and extensively drug-resistant (XDR-TB) strains to guide treatment decisions</li><li><strong>Outbreak Investigation:</strong> Identify transmission clusters and track spread of resistant strains across populations</li><li><strong>Public Health Surveillance:</strong> Monitor emergence and prevalence of drug resistance mutations in TB surveillance programs</li><li><strong>Research Studies:</strong> Characterize resistance mechanisms, study TB evolution, and identify novel resistance mutations</li><li><strong>Treatment Monitoring:</strong> Track emergence of resistance during therapy and detect treatment failure early</li></ul><h2>What You Need</h2><h3>1. Sequencing Data (FASTQ Files)</h3><p>Whole genome sequencing from <em>M. tuberculosis</em> clinical isolates or direct patient samples:</p><ul><li><strong>Sample type:</strong> Pure culture isolates (preferred) or clinical specimens (sputum, BAL) with sufficient TB DNA</li><li><strong>Platform:</strong> Illumina sequencing (paired-end recommended) or Oxford Nanopore long reads</li><li><strong>Read length:</strong> Illumina: 75-150bp paired-end; Nanopore: any length</li><li><strong>Coverage depth:</strong> Minimum 30-50x coverage recommended for reliable variant calling; 50-100x ideal for clinical use</li><li><strong>File format:</strong> Compressed FASTQ files (.fastq.gz, .fq.gz) - paired-end (R1/R2) or single-end</li></ul><h3>2. Sample Sheet (CSV/TSV File)</h3><p>Create a CSV or TSV file listing your samples with this format:</p><pre>sample,fastq_1,fastq_2\nTB_patient001,sample1_R1.fastq.gz,sample1_R2.fastq.gz\nTB_patient002,sample2_R1.fastq.gz,sample2_R2.fastq.gz\nTB_outbreak_isolate1,isolate1_R1.fastq.gz,isolate1_R2.fastq.gz</pre><p><strong>Column Details:</strong></p><ul><li><strong>sample:</strong> Unique sample identifier (patient ID, isolate number, or lab accession)</li><li><strong>fastq_1:</strong> Path to Read 1 FASTQ file (forward reads). For single-end data, only provide this column</li><li><strong>fastq_2:</strong> Path to Read 2 FASTQ file (reverse reads). Leave empty or omit for single-end sequencing</li></ul><p><strong>Important Notes:</strong></p><ul><li>File paths can be local paths or URLs to cloud storage</li><li>For single-end data, create a CSV with only sample and fastq_1 columns</li><li>Sample names should not contain spaces or special characters (use underscores or hyphens)</li></ul><h2>What You'll Get</h2><h3>Drug Resistance Predictions</h3><ul><li><strong>AMR Profile Reports:</strong> Comprehensive prediction of resistance/susceptibility to all first-line (rifampicin, isoniazid, ethambutol, pyrazinamide) and second-line drugs (fluoroquinolones, aminoglycosides, etc.)</li><li><strong>Mutation Catalog:</strong> Detailed list of detected resistance-associated mutations with genomic positions, reference/alternate alleles, and supporting evidence</li><li><strong>Confidence Scoring:</strong> Each resistance prediction includes confidence levels based on WHO mutation catalog and literature evidence</li><li><strong>Treatment Recommendations:</strong> Suggested drug regimens based on predicted resistance profile</li></ul><h3>Lineage & Phylogenetic Classification</h3><ul><li><strong>Lineage Assignment:</strong> Precise classification into major <em>M. tuberculosis</em> lineages (e.g., Beijing, Euro-American, East-African-Indian, Indo-Oceanic)</li><li><strong>Sub-lineage Detail:</strong> Fine-grained phylogenetic placement within lineage families</li><li><strong>Spoligotype Prediction:</strong> Traditional spoligotype pattern prediction for epidemiological comparison</li><li><strong>Transmission Markers:</strong> Identification of strain-specific SNPs useful for outbreak investigation</li></ul><h3>Quality Control & Sequencing Metrics</h3><ul><li><strong>Coverage Statistics:</strong> Genome-wide coverage depth, breadth, and uniformity metrics</li><li><strong>Mapping Quality:</strong> Percentage of reads mapped to reference genome, properly paired reads</li><li><strong>Variant Quality Scores:</strong> Filter flags for low-confidence variants</li><li><strong>Contamination Detection:</strong> Mixed infection warnings and potential contamination flags</li></ul><h3>Output File Formats</h3><ul><li><strong>JSON Reports:</strong> Structured, machine-readable results for database integration and automated interpretation</li><li><strong>Text Reports:</strong> Human-readable summaries for clinical review</li><li><strong>VCF Files:</strong> Standard variant call format files with all detected SNPs and indels</li><li><strong>BAM Files:</strong> Aligned reads for manual inspection in genome browsers (IGV, Tablet)</li><li><strong>Summary Tables:</strong> Combined results across all samples for cohort-level analysis</li></ul><h2>Key Features of TBProfiler</h2><ul><li><strong>Comprehensive Drug Coverage:</strong> Predicts resistance to 15+ anti-TB drugs including novel agents (bedaquiline, delamanid, linezolid)</li><li><strong>WHO-Endorsed Mutation Catalog:</strong> Uses the WHO-endorsed TB mutation catalog with >2000 validated resistance mutations</li><li><strong>Automated Workflow:</strong> Integrated pipeline from raw reads to final report - no manual intervention required</li><li><strong>Fast Turnaround:</strong> Process samples in 15-30 minutes per isolate, enabling same-day diagnostics</li><li><strong>Flexible Input:</strong> Accepts Illumina short reads, Nanopore long reads, or pre-called VCF files</li><li><strong>Batch Processing:</strong> Efficiently analyze dozens to hundreds of samples in parallel</li><li><strong>Validated Performance:</strong> Extensively validated against phenotypic drug susceptibility testing with >95% concordance</li></ul><h2>Expected Analysis Time</h2><ul><li><strong>Single sample (50x coverage):</strong> 15-30 minutes</li><li><strong>Small batch (5-10 samples):</strong> 1-2 hours</li><li><strong>Medium cohort (20-50 samples):</strong> 3-6 hours</li><li><strong>Large surveillance study (100+ samples):</strong> 6-12 hours (with parallel processing)</li><li><strong>Note:</strong> Time depends on coverage depth, read length, and available computational resources</li></ul><h2>Scientific Background</h2><p>TBProfiler implements a standardized pipeline for TB genomic analysis based on best practices from the WHO and academic consortia (CRyPTIC, ReSeqTB). It aligns reads to the <em>M. tuberculosis</em> H37Rv reference genome using BWA or minimap2, calls variants with BCFtools or GATK, and annotates mutations using a curated database of resistance-associated variants. The resistance database integrates evidence from thousands of phenotype-genotype correlation studies, WHO technical reports, and systematic literature reviews. Lineage assignment uses a hierarchical SNP barcode system validated against whole-genome phylogenies.</p><h2>Clinical & Research Applications</h2><ul><li><strong>Precision Medicine:</strong> Tailor treatment regimens to individual resistance profiles, avoiding ineffective drugs</li><li><strong>Rapid Diagnostics:</strong> Detect resistance weeks faster than culture-based phenotypic testing</li><li><strong>Outbreak Response:</strong> Rapidly characterize outbreaks and identify transmission networks</li><li><strong>Surveillance:</strong> Monitor population-level trends in drug resistance and strain diversity</li><li><strong>Research:</strong> Discover novel resistance mechanisms, validate new diagnostic targets, study TB evolution</li></ul><p><strong>References:</strong></p><ul><li>TBProfiler: Phelan et al. (2019) <em>Genome Medicine</em> - <a href='https://genomemedicine.biomedcentral.com/articles/10.1186/s13073-019-0650-x' target='_blank'>doi:10.1186/s13073-019-0650-x</a></li><li>WHO Mutation Catalog: WHO (2021) - <a href='https://www.who.int/publications/i/item/9789240028173' target='_blank'>Catalogue of mutations in Mycobacterium tuberculosis</a></li><li>CRyPTIC Consortium: <a href='https://www.crypticproject.org/' target='_blank'>www.crypticproject.org</a></li></ul><p><a href='https://jodyphelan.gitbook.io/tb-profiler/' target='_blank'>Full TBProfiler Documentation</a> | <a href='https://github.com/jodyphelan/TBProfiler' target='_blank'>GitHub Repository</a></p>",
  "imageUrl": "https://raw.githubusercontent.com/nf-core/taxprofiler/master/docs/images/nf-core-taxprofiler_logo_custom_light.png",
  "command": "nextflow run BCCDC-PHL/tbprofiler-nf --fastq_input ${input} --outdir ${outdir} -r main -profile singularity",
  "engineType": "NEXTFLOW",
  "jobConfig": [
    {
      "type": "Select",
      "label": "System Size",
      "name": "system_size",
      "hidden": true,
      "description": "Select compute resources based on number of samples and coverage depth. Start with SMALL for testing, scale up for production batches.",
      "options": [
        {
          "label": "SMALL (8 CPUs, 30GB RAM) - Testing or 1-3 samples",
          "value": "small",
          "mapValue": {
            "nodeSize": "SMALL",
            "numNodes": 1,
            "withGpu": false
          }
        },
        {
          "label": "MEDIUM (32 CPUs, 120GB RAM) - Standard batches (5-20 samples)",
          "value": "medium",
          "mapValue": {
            "nodeSize": "MEDIUM",
            "numNodes": 1,
            "withGpu": false
          }
        },
        {
          "label": "LARGE (64 CPUs, 360GB RAM) - Large batches (20-100 samples)",
          "value": "large",
          "mapValue": {
            "nodeSize": "LARGE",
            "numNodes": 1,
            "withGpu": false
          }
        }
      ],
      "defaultValue": "medium"
    }
  ],
  "spec": [
    {
      "type": "Stash File",
      "label": "Sample Sheet",
      "name": "input",
      "description": "CSV or TSV file with sample information. Required columns: sample (unique ID), fastq_1 (path to R1 or single-end reads), fastq_2 (path to R2 for paired-end, optional). Each row represents one M. tuberculosis isolate to analyze.",
      "defaultValue": "",
      "hidden": false,
      "required": true,
      "disabled": false,
      "restrictions": {
        "allow_files": true,
        "allowed_file_types": [
          ".csv",
          ".tsv"
        ]
      }
    },
    {
      "type": "Stash File",
      "label": "Output Directory",
      "name": "outdir",
      "description": "Directory where analysis results will be saved. Includes drug resistance predictions, lineage classifications, variant calls (VCF), aligned reads (BAM), and QC reports for all samples.",
      "defaultValue": "./tbprofiler-results",
      "hidden": false,
      "required": true,
      "disabled": false,
      "restrictions": {
        "allow_files": false,
        "allow_folders": true
      }
    }
  ],
  "tags": [
    {
      "id": "fb1ee42a-629a-4d99-9e7f-1da3c5f7a691",
      "name": "biology",
      "type": "field"
    },
    {
      "id": "6e4e74a4-560e-4674-95c3-60fe895b8c91",
      "name": "genomics",
      "type": "subfield"
    },
    {
      "id": "831477f4-f572-4e27-af83-037661489800",
      "name": "analysis",
      "type": "task"
    }
  ]
}