{
  "name": "biomni-annotate-celltype-panhumanpy",
  "title": "Biomni: Annotate Celltype Panhumanpy",
  "description": "Hierarchical cell type annotation using panhumanpy and Azimuth Neural Network",
  "content": "<h3>Overview</h3><p>Performs hierarchical cell type annotation on single-cell RNA-seq data using the PanhumanPy framework with Azimuth Neural Network. This tool leverages reference atlases to assign cell type labels at multiple levels of granularity, from broad categories to fine-grained subtypes, enabling accurate cell identity determination across diverse tissues.</p><h3>Input Parameters</h3><ul><li><strong>adata_file</strong> (string): Path to AnnData H5AD file containing single-cell expression data from stash</li><li><strong>feature_names_col</strong> (string, optional): Column name in adata.var containing gene names (default: use index)</li><li><strong>no_refine</strong> (boolean, optional): Skip label refinement for consistent granularity (default: false)</li><li><strong>no_umap</strong> (boolean, optional): Skip ANN embeddings and UMAP generation (default: false)</li><li><strong>output</strong> (string): Output directory path</li></ul><h3>Input Format</h3><p>Provide a JSON file with the following structure:</p><pre>{\n  \"adata_file\": \"/path/to/scrna_data.h5ad\",\n  \"feature_names_col\": \"gene_symbols\",\n  \"no_refine\": false,\n  \"no_umap\": false,\n  \"output\": \"/output/directory\"\n}</pre><h3>Biological Use Case</h3><p>Critical for single-cell analysis pipelines to systematically identify cell populations. Used to annotate cell types in tissue atlases, discover rare cell populations, validate experimental cell sorting, and compare cell type composition across conditions or disease states.</p><h3>Output</h3><p>Generates annotation_log.txt with cell type predictions at multiple hierarchical levels, confidence scores, UMAP visualizations, and an updated H5AD file with annotations stored in adata.obs.</p><h3>Category</h3><p>genomics</p>",
  "command": "rm -rf prod_apps 2>/dev/null || true && git clone --depth 1 https://github.com/CamberCloud-Inc/prod_apps.git prod_apps && python3 prod_apps/biomni/genomics/annotate_celltype_panhumanpy.py \"${inputFile}\" -o \"${outputDir}\"",
  "engineType": "MPI",
  "jobConfig": [
    {
      "type": "Select",
      "label": "System Size",
      "name": "system_size",
      "hidden": true,
      "description": "Select the configuration for the job",
      "options": [
        {
          "label": "Extra Extra Small CPU",
          "value": "xxsmall_cpu",
          "mapValue": {
            "nodeSize": "XXSMALL",
            "numNodes": 1,
            "withGpu": false
          }
        }
      ],
      "defaultValue": "xxsmall_cpu"
    }
  ],
  "spec": [
    {
      "type": "Stash File",
      "name": "inputFile",
      "label": "Input File",
      "description": "Input file from stash (JSON format)",
      "defaultValue": ""
    },
    {
      "type": "Stash File",
      "name": "outputDir",
      "label": "Output Directory",
      "description": "Output directory in stash",
      "defaultValue": "./"
    }
  ]
}