{
  "name": "biomni-analyze-flow-cytometry-immunophenotyping",
  "title": "Biomni: Analyze Flow Cytometry Immunophenotyping",
  "description": "Analyze flow cytometry data to identify and quantify specific cell populations based on surface markers. Applies sequential gating strategies to identify cell populations, with optional compensation for fluorescence spillover.",
  "content": "<h3>Overview</h3><p>Analyze flow cytometry data to identify and quantify specific cell populations based on surface markers. This tool applies sequential gating strategies to identify cell populations (e.g., CD4+ T cells, CD8+ T cells, B cells), with optional compensation for fluorescence spillover. Processes FCS (Flow Cytometry Standard) files and generates detailed immunophenotyping reports including population percentages, marker expression levels, and visualization plots.</p><h3>Input Parameters</h3><ul><li><strong>fcs_file_path</strong> (string, required): Path to the FCS file containing flow cytometry data from the cytometer.</li><li><strong>gating_strategy</strong> (object, required): Dictionary defining sequential gates to identify cell populations. Each gate specifies fluorescence channels and threshold values (e.g., {\"CD4+\": {\"channel\": \"CD4-FITC\", \"min\": 100, \"max\": 10000}}).</li><li><strong>compensation_matrix</strong> (object, optional): Compensation matrix to correct for fluorescence spillover between channels. Typically exported from cytometer software or calculated from single-stain controls.</li><li><strong>output_dir</strong> (string, optional): Directory path where analysis results, plots, and CSV files will be saved. Defaults to \"./results\".</li></ul><h3>Input Format</h3><pre>{\n  \"fcs_file_path\": \"/path/to/sample.fcs\",\n  \"gating_strategy\": {\n    \"Lymphocytes\": {\"channel\": \"FSC-A\", \"min\": 50000, \"max\": 250000},\n    \"CD4+\": {\"channel\": \"CD4-FITC\", \"min\": 200}\n  },\n  \"compensation_matrix\": {\n    \"FITC\": {\"PE\": 0.02, \"APC\": 0.01},\n    \"PE\": {\"FITC\": 0.03, \"APC\": 0.015}\n  },\n  \"output_dir\": \"./immunophenotyping_results\"\n}</pre><h3>Biological Use Case</h3><p>Essential for immunological research and clinical diagnostics to characterize immune cell subsets in blood, tissue, or cultured samples. Applications include: identifying T cell subsets (CD4+, CD8+, Tregs) in cancer immunotherapy studies, quantifying B cell populations in autoimmune disease research, monitoring immune reconstitution after transplantation, and phenotyping rare cell populations in stem cell research. The compensation feature is critical for multi-color panels (4+ fluorochromes) to ensure accurate quantification.</p><h3>Output</h3><p>Returns a JSON report containing: (1) population percentages for each gated subset, (2) absolute cell counts per population, (3) mean fluorescence intensity (MFI) for each marker, (4) PNG plots showing scatter plots with gates overlaid, (5) CSV file with per-cell event data, and (6) statistical summary including coefficients of variation. All files are saved to the specified output directory.</p><h3>Category</h3><p>cell_biology</p>",
  "command": "rm -rf prod_apps 2>/dev/null || true && git clone --depth 1 https://github.com/CamberCloud-Inc/prod_apps.git prod_apps && python3 prod_apps/biomni/cell_biology/analyze_flow_cytometry_immunophenotyping.py \"${inputFile}\" -o \"${outputDir}\"",
  "engineType": "MPI",
  "jobConfig": [
    {
      "type": "Select",
      "label": "System Size",
      "name": "system_size",
      "hidden": true,
      "description": "Select the configuration for the job",
      "options": [
        {
          "label": "Extra Extra Small CPU",
          "value": "xxsmall_cpu",
          "mapValue": {
            "nodeSize": "XXSMALL",
            "numNodes": 1,
            "withGpu": false
          }
        }
      ],
      "defaultValue": "xxsmall_cpu"
    }
  ],
  "spec": [
    {
      "type": "Stash File",
      "name": "inputFile",
      "label": "Input File",
      "description": "Input file from stash (JSON format)",
      "defaultValue": ""
    },
    {
      "type": "Stash File",
      "name": "outputDir",
      "label": "Output Directory",
      "description": "Output directory in stash",
      "defaultValue": "./"
    }
  ]
}